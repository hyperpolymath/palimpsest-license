// SPDX-License-Identifier: PMPL-1.0-or-later
= Quantum Safe Specification
:toc:
:toclevels: 3

== Related Specifications
* link:PMPL-SPEC.adoc[PMPL-SPEC]
* link:EXHIBITS-SPEC.adoc[EXHIBITS-SPEC]
* link:ETHICAL-USE-SPEC.adoc[ETHICAL-USE-SPEC]
* link:PROVENANCE-SPEC.adoc[PROVENANCE-SPEC]
* link:QUANTUM-SAFE-SPEC.adoc[QUANTUM-SAFE-SPEC]
* link:6SCM-SPEC.adoc[6SCM-SPEC]
* link:SPEC-INDEX.adoc[SPEC-INDEX]

== Overview

This specification defines the cryptographic requirements for post-quantum provenance signatures in the Palimpsest-MPL License.

== Approved Algorithms

=== Primary (RECOMMENDED)

[cols="2,2,3"]
|===
| Algorithm | Standard | Security Level

| ML-DSA-65
| FIPS 204
| NIST Level 3 (128-bit classical, 64-bit quantum)

| SLH-DSA-256s
| FIPS 205
| NIST Level 5 (256-bit classical, 128-bit quantum)
|===

=== Secondary (Approved)

[cols="2,2,3"]
|===
| Algorithm | Standard | Use Case

| ML-DSA-44
| FIPS 204
| Constrained environments

| ML-DSA-87
| FIPS 204
| High-security applications

| FN-DSA-512
| FIPS 206
| Compact signatures

| FN-DSA-1024
| FIPS 206
| High-security compact
|===

=== Hybrid Schemes

Combinations of PQC and classical algorithms for transition period:

* ML-DSA-65 + Ed25519
* SLH-DSA-128s + ECDSA-P256

== Signature Format

=== Header Fields

[source]
----
-----BEGIN PALIMPSEST SIGNATURE-----
Version: PMPL-SIG/1.0
Algorithm: <algorithm-id>
Signer: <signer-identity>
Timestamp: <ISO-8601-utc>
Content-Hash: <sha3-256-hex>

<base64-signature-data>
-----END PALIMPSEST SIGNATURE-----
----

=== Field Definitions

Version::
Protocol version. Currently `PMPL-SIG/1.0`.

Algorithm::
One of: `ML-DSA-44`, `ML-DSA-65`, `ML-DSA-87`, `SLH-DSA-128s`, `SLH-DSA-256s`, `FN-DSA-512`, `FN-DSA-1024`, or hybrid identifiers.

Signer::
Email, URL, or key fingerprint identifying the signer.

Timestamp::
ISO 8601 format in UTC: `YYYY-MM-DDTHH:MM:SSZ`

Content-Hash::
SHA3-256 hash of signed content in lowercase hexadecimal.

== Provenance Chain

=== Format

[source]
----
-----BEGIN PALIMPSEST PROVENANCE-----
Version: PMPL-PROV/1.0

Contribution: <contribution-hash>
Author: <author-identity>
Date: <ISO-8601-date>
Signature: <signature-file-or-inline>

Parent: <parent-contribution-hash>
Parent: <parent-contribution-hash>
-----END PALIMPSEST PROVENANCE-----
----

=== Chain Verification

1. Parse provenance block
2. Verify each contribution signature
3. Recursively verify parent contributions
4. Build DAG of verified contributions

== Key Management

=== Generation

[source,bash]
----
# Generate ML-DSA-65 key pair
pmpl-keygen --algorithm ML-DSA-65 --output ~/.pmpl/

# Output files:
# ~/.pmpl/private.pem  (keep secure!)
# ~/.pmpl/public.pem   (publish)
----

=== Publication

Keys SHOULD be published at:

1. `.well-known/pmpl-keys.json` on signer's domain
2. Key servers supporting PQC (when available)

=== Format

[source,json]
----
{
  "version": "1.0",
  "keys": [
    {
      "id": "<fingerprint>",
      "algorithm": "ML-DSA-65",
      "public_key": "<base64-public-key>",
      "created": "<ISO-8601>",
      "expires": "<ISO-8601-or-null>",
      "revoked": false
    }
  ]
}
----

== Verification

=== Process

1. Locate signature file (`.sig` extension)
2. Parse signature block
3. Retrieve signer's public key
4. Compute SHA3-256 of content
5. Verify computed hash matches `Content-Hash`
6. Verify signature using specified algorithm
7. Optionally verify timestamp against trusted source

=== Trust Model

* Trust anchors configured per-project
* Web of trust for community verification
* Certificate transparency for key publication

== Transition Timeline

[cols="1,3"]
|===
| Period | Requirements

| 2025-2030
| Hybrid signatures RECOMMENDED

| 2030-2035
| PQC-only for new signatures

| Post-2035
| Classical-only signatures deprecated
|===

== Implementation Libraries

=== Recommended

[cols="2,3"]
|===
| Language | Library

| Rust
| `pqcrypto`, `oqs-rs`

| Go
| `circl/sign/dilithium`

| Python
| `liboqs-python`

| C/C++
| `liboqs`

| JavaScript
| `liboqs` (WASM)
|===

== Security Considerations

=== Side-Channel Resistance

Implementations MUST use constant-time operations for:

* Signature generation
* Key operations
* Hash comparisons

=== Random Number Generation

MUST use cryptographically secure RNG:

* `/dev/urandom` (Linux)
* `getrandom()` syscall
* Hardware RNG where available

== Related Specifications

* https://csrc.nist.gov/pubs/fips/204/final[FIPS 204 - ML-DSA]
* https://csrc.nist.gov/pubs/fips/205/final[FIPS 205 - SLH-DSA]
* https://csrc.nist.gov/pubs/fips/206/final[FIPS 206 - FN-DSA]
* link:PMPL-SPEC.adoc[Main License Specification]
